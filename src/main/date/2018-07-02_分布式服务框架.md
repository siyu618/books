分布式服务框架：原理与实践

***Chapter1：医用架构渐进***
   * 传统垂直应用架构
      * LAMP （Linux + Apache + PHP+ MySQL）
      * MVC（SSH + Tomact）
      * 挑战
         1. 复杂应用的开发维护成本变高，部署效率逐渐降低
         1. 团队协作效率差
         1. 系统可靠性变差
         1. 为何和定制困难
         1. 新功能上线周期变长
   * RPC架构
      * 传输 TCP/UDP
      * 序列化 xml/json/binary
      * 通信细节 
      * 技术核心点
         * 远程服务提供者需要以某种形式提供服务调用相关的信息
         * 远程对象代理
         * 通信
         * 序列化
      * 业界主流RPC框架
         * Apache Thrift
         * Hadoop Avro-RPC
         * caucho提供的基于binaryPRC实现的远程通信框架Hessian
         * google开源的基于HTTP/2和ProtoBuf的通用RPC框架gRPC
      * RPC面临的挑战
   * SOA服务化架构
      * 面向服务的设计原则
         * 服务客服王勇
         * 服务共享一个标准契约
         * 服务是松耦合的
         * 服务是底层逻辑的抽象
         * 服务是可组合的、可编排的
         * 服务是自治的
         * 服务是无状态的
         * 服务是可被自动发现的
      * 服务治理
         * 服务定义
         * 服务生命周期管理
         * 服务版本治理
         * 服务注册中心
         * 服务监控
         * 运行期服务质量保障
         * 快递的故障定界定位手段
         * 服务安全
   * 微服务架构
      * 什么是微服务
         * 原子，专注于做一件事
         * 高密度部署
         * 敏捷交付
         * 微自治

***Chapter2：分布式服务框架入门***
   * 分布式服务框架诞生背景
      * 应用从集中式走向分布式
      * 亟需服务治理
         * 生命周期管理
         * 服务容量规划
         * 运行期治理
         * 服务安全
   * 业界分布式服务框架介绍
      * 阿里Dubo         
      * 淘宝HSF
      * Amazon Coral Service
   * 分布式服务框架设计
      * 架构原理
         * RPC面临的挑战
         * Filter Chain层
         * Service层
      * 功能特性
         * 服务订阅发布
         * 服务路由
         * 集群容错
         * 服务调用
         * 多协议
         * 序列化方式
         * 统一配置
      * 性能特性
         * 高性能 TPS
         * 低延时 Latency
         * 性能线性增长
      * 可靠性
         * 服务注册中心：服务健康状态检测，故障切换，HA
         * 消除单点故障：服务无状态，服务集群容错
         * 链路健壮性：心跳检测， 断链重连机制
      * 服务治理 

***Chapter3：通信框架***
   * 关键技术点
      * 长连接还是短连接
         * 使用长连接：长连接更节省资源；远程通信是常态，调用时延是关键指标
      * BIO or NIO
         * JDK使用了epool代替传统的select实现，所以其没有最大连接句柄1024/2048的限制
      * 自研 or 开源
         * netty
   * 功能设计
      * 服务端设计
         * 职责
            1. 提供上层API（屏蔽底层NIO），用于初始化服务端实例
            1. 提供可扩展的编码解析差价
            1. 提供拦截面，用用似有协议栈开发
         * 设计原则：
            1. 服务端只提供上层的API，不予任何具体协议绑定
            1. 无语端提供用的API要尽量屏蔽底层的通信细节，防止底层的变更引起上层的变更
            1. 服务端功能上不要求全，重点在可扩展性上
         * 基于Netty开发通信框架服务端的关键点
            1. 用于接受客户端连击刀额线程池：bossGroup，设置为1即可
            1. TCP参数设置：建议在API层面开放ICP参数设置
            1. 编解码框架的置顶
            1. 通信层业务逻辑的定制
      * 客户端设计
   * 可靠性设计
      * 链路有效性检测
         * 心跳检测的三个层面
            1. TCP层面的心跳检测，进TCP的KEep-Alive机制，其作用于是整个TCP协议栈
            1. 协议底层的心跳检测：主要存在与长连接协议中，例如SMPP
            1. 应用层心跳检测
         * 断连重连机制
         * 消息缓存重发
            * 当调用消息发送接口的时候，消息并没有真正被写入socket中，而是先放入NIO通信框架的消息发送队列中
         * 资源优雅释放
   * 性能设计
      * 性能差三宗罪：网络传输方式问题、序列化性能差、线程模型问题
      * 通信性能三原则
         * 传输、协议、线程
      * 高性能之道（Netty）
         * 异步非阻塞通信：netty
         * 高效的IO线程模型：reactor
         * 高性能的序列化框架
   * 最佳实践
      * 指定线程池大小
      * IO线程池使用不当，导致通信线程膨胀

***Chapter4：序列化与反序列化***
   * 关键概念的澄清
      * 序列化与通信框架的关系：非强耦合
      * 序列化与通信协议的关系：也是解耦的
      * 师傅需要支持做种序列化方式
         * text + binary
   * 功能设计
      * 功能丰富度
         * 支持的类型是否丰富
      * 跨语言支持
      * 兼容性
      * 性能： binary
   * 扩展性设计
      * 内置的徐丽华反序列化功能类
      * 反序列化扩展
         * 固定长度、通过回车换行符区分、特定分隔符、通过在协议头或消息头中设置长度字段来标志
      * 序列化扩展
   * 最佳实践
      * 接口的前向兼容性规范
      * 高并发下的稳定性

***Chapter5：协议栈***
   * 对接异构第三方服务室，通常会选择HTTP/RESTFUL等共有协议；对于内部不同模块之间的通常采用性能较高的二进制似有协议
   * 关键技术点分析
      * 是否必须支持多协议：否
      * 公有协议还是似有协议
      * 集成开源还是自研
   * 功能设计
      * 功能描述
      * 通信模型
      * 协议消息定义
      * 协议栈消息序列化支持的字段类型
      * 协议消息的序列化和反序列化
      * 链路创建
      * 链路关闭
   * 可靠性设计
      * 客户端链接超时
      * 客户端重连机制
      * 客户端重复握手保护
      * 消息缓存重发
      * 心跳机制
   * 安全性设计
      * 直连
      * 安全认证机制
      * SSL/TLS
   * 最佳实践：协议的前向兼容性

***Chapter6：服务路由***
   * 透明化路由
      * 基于服务注册中心的定于发布
      * 消费者缓存服务提供者的地址
   * 负载均衡
      * 轮询
      * 服务调用延时
      * 一致性哈希
      * 粘滞连接
         * 用于有状态服务，，尽可能让客户端总是想统一提供者发起服务调用
   * 本地路由优先策略
      * injvm模式 （同一个jvm内）
      * innative模式 （同一个机器上）
   * 路由规则
     * 条件路由规则：consumerIp != 192.168.1.1
     * 脚本路由规则
   * 路由策略定制
      * 默认的路由策略
      * 支持业务扩展路由算法
         * 灰度升级
         * 服务故障、业务高峰期的导流
         * 与专业领域强相关的非通用路由定制需求
   * 配置化路由
      * 本地配置
      * 统一注册管理
      * 动态下发
      * 优先级：客户端配置 > 服务端配置 > 全局配置
   * 最佳实践-多机房路由

***Chapter7：集群容错***
   * 集群容错场景
      * 通信链路故障
      * 服务端超时
      * 服务端调用失败
   * 容错策略
      * 失败自动切换（Failover）
      * 失败通知（Failback）
      * 失败缓存（Failcache）
      * 快速失败
      * 容错策略扩展
         * 容错接口的开放
         * 疲敝底层细节，用户定制简单
         * 配置应该天生支持扩展，不要荣用户扩展服务框架爱Schema

***Chapter8：服务调用***
   * 几个误区
      * NIO就是异步服务 ？
      * 服务调用天生就是同步的？
         * OneWay模式：只有请求，没有应答，例如通知消息
         * 请求-应答模式：一请求，一应答的模式，这种模式最常用
      * 异步调用服务性能更高
         * 往往更高。
   * 服务调用方式
      * 同步服务调用
      * 异步服务调用
      * 并行服务调用
      * 泛化调用：泛化调用和泛化实现
   * 最佳实践
      * 降低业务E2E实验，业务调用链是佛太长、某些服务是否不太可靠
         * 并行化
      * 可靠性角度：
         * 异步调用防止故障扩散
      * 业务场景：通用的测试框架
      * 传统的RPC调用：服务调用比较简单，对于时延要求不高的可以考虑同步服务调用

***Chapter9：服务注册中心***
   * 几个概念
      * 服务提供者
      * 服务消费者
      * 服务注册中心
   * 关键功能特性设计
      * 支持对等集群
      * 提供CRUD接口
      * 安全加固
      * 订阅发布机制
      * 可靠性
   * 基于ZooKeeper的服务注册中心设计
      * 服务订阅发布流程设计
      * 服务健康状态监测
      * 对等几圈防止单点故障
      * 变更通知机制

***Chapter10：服务发布和引用***
   * 服务发布设计
      * 服务发布的几种方式
         * xml配置化方式
         * 注解
         * API      
      * 本地实现类封装成代理
      * 服务提供者信息注册
   * 服务引用设计
      * 本地接口调用转换成远程服务调用
      * 服务地址本地缓存
      * 远程服务调用
   * 最佳实践  
      * 对等设计原则
      * 启动顺序问题
      * 同步还是异步发布服务
      * 警惕网络风暴
      * 配置扩展

***Chapter11：服务灰度发布***
   * AB test就是一种灰度发布方式：让一部分用户继续使用A，一部分用户开始使用B
   * 服务灰度发布流程设计
      * 主要作用
         * 解决服务升级不兼容问题
         * 及早将获得用户的意见反馈，晚上产品功能，提升服务质量
         * 缩小服务升级所影响的用户范围，降低升级风险
         * 让用户及早参与产品测试，加强用户互动
      * 灰度环境准备
      * 灰度规则设置
      * 灰度规则下发
      * 灰度路由
      * 失败回滚
      * 灰度发布总结
   * 终结

***Chapter12： 参数传递***
   * 内部传参
      * 业务内部参数传递
      * 服务框架和业务之间的参数传递
   * 外部传参
      * 通信协议支持
      * 传参接口定义
   * 最佳实践  
      * 防止参数互相覆盖
      * 参数生命周期管理

***Chapter13：服务多版本***
   * 服务多版本管理设计
      * 服务版本号管理
      * 服务提供者
      * 服务消费者
      * 基于版本号的服务路由
      * 服务热升级
   * 与OSGi的对比
      * 模块化开发
      * 插件热部署和热升级
      * 不适用OSGi的其他理由

***Chapter14：流量控制***
   * 静态流控
      * 传统静态流控世界方案：根据集群服务节点个数和静态流控阈值，计算每个服务节点分摊的QPS阈值
      * 传统方案的缺点：            
         * 节点数的动态变化：扩容等
         * 服务节点宕机
      * 动态配额分配制
      * 动态配额申请制
   * 动态流控
      * 动态流控因子
      * 分级流控
   * 并发控制
      * 服务端全局控制
      * 服务消费者监控
   * 链接控制
      * 服务端连接数流控
      * 服务消费者连接数流控
   * 并发和链接控制算法

***Chapter15：服务降级***
   * 屏蔽降级
      * 屏蔽降级的流程
      * 屏蔽降级的设计实现
   * 容错降级
      * 容错降级的工作原理
      * 运行时容错降级
   * 业务降级
      * 业务方通处理  

***Chapter16：服务优先级调度***
   * 设置服务优先级
   * 线程调度器方案
      * setPriority
   * java优先级队列
      * 缺点是导致优先级低的积压
   * 加权优先级队列
      * 由一些列普通的队列组成，每个任务队列与服务优先级1：1（N）对应
   * 服务迁入迁出
      * 优先级低的服务的部分实例迁出（从配置中心中去掉），以降低核心资源的使用
      * 业务高峰期过后恢复执行

***Chapter17：服务治理***
   * 服务治理技术的历史变迁
      * 第一代服务治理SOA Governance
      * 第二代以分布式服务框架为中心的服务治理
      * 微服务架构 + 云端服务治理
   * 应用服务化之后面临的挑战
      * 多团队协作问题
      * 服务安全问题
      * 线下服务管控
      * 线上服务治理，保障服务SLA
      * 故障快速界定定位
   * 服务治理  
      * 防止业务服务框架腐化
      * 快速故障定界定位
      * 服务为管控
      * 服务生命周期管理
      * 服务治理架构设计
         * 服务治理展示层
         * 服务治理SDK
         * 运行态服务治理功能设计
         * 线下服务治理
         * 安全和权限管理

***Chapter18：分布式消息跟踪***
   * 业务场景分析
      * 故障的快速界定定位
      * 调用路径分析
      * 调用来源和去向分析
   * 分布式消息跟中系统设计
      * 系统架构
      * 埋点日志
      * 采样率
      * 采集和存储埋点日志
      * 计算和展示
      * 调用链扩展

***Chapter19：可靠性分析***
   * 服务健康状态监测   
      * 基于服务注册中心状态检测
      * 链路有效性状态监测机制
   * 服务健康度监测
   * 服务故障隔离
      * 进程级故障隔离
      * VM级故障隔离
      * 物理机故障隔离
      * 机房故障隔离
   * 其他可靠性分析
      * 服务注册中心
      * 监控中心
      * 服务提供者

***Chapter20：微服务架构***
   * 微服务架构产生的历史背景
      * 研发成本提高
      * 运维成本高
      * 新需求上线周期长
   * 微服务架构带来的改变
      * 应用解耦
      * 分而治之
      * 敏捷交付
   * 微服务架构解析
      * 微服务划分原则
      * 开发微服务
      * 基于Docker容器部署微服务
      * 治理和运维微服务

***Chapter21：服务化最佳实践***
   * 性能和时延问题
      * RPC框架高性能设计
      * 业务框架最佳实践
   * 事务一致行问题            
   * 研发团队协作问题




关于成熟：
   * 说话的语气语速，给人以成熟稳重的感觉，不能表达未经思考深思熟虑的想法

技术与业务的结合：
   * 用什么技术解决了什么业务问题，用什么技术做了什么业务
   * 对于技术发展及其方向能有自己的理解
   * 这个需要积累，每天看看最新的新闻（rss）










